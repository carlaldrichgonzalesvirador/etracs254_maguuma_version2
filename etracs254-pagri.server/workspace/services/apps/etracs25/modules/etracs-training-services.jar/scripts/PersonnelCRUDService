import com.rameses.annotations.*
import com.rameses.common.*
import com.rameses.services.extended.*;

public class PersonnelCRUDService extends ActiveCrudListService{
	

	@ActiveDB(value='personnel', em='training')
	def em





@ProxyMethod
public def getColumns(params)
{
return [

	 [name:'idno', caption:'ID No.', width:120],
	 [name:'lastname', caption:'Last Name', width:200],
	 [name:'firstname', caption:'First Name', width:200],
	 [name:'middlename', caption:'Middle Name', width:200],
	 [name:'salary', caption:'Salary', type:'decimal'],

	 ]
	 }

	 public void afterCreate(entity){
	 	//save the trainings
	 	entity.trainings.each{
	 		em.create(it, "training");
	 	}
	 }

	 public void afterUpdate(entity){
	 	//update trainings
	 	entity.trainings.each{
	 		em.save(it, "training");
	 	}

	 	//remove deleted items
	 	entity._trainings.each{
	 		em.delete(it, "training");
	 	}

	 	loadTrainings(entity)
	 }

	 public void afterOpen(entity){
	 	loadTrainings(entity)
	 }

	 public void beforeRemoveEntity(entity){
	 	entity.trainings.each{
	 		em.delete(it, "training");
	 	}
	 }

	 void loadTrainings(entity){
	 	if (entity){
	 		entity.trainings = em.getTrainings(entity)
	 	}
	 }
}
